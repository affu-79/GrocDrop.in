<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - GrocDrop.in</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }

    .navbar {
      background-color: #e3f2fd;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 0.5rem 1rem;
    }

    .navbar-brand {
      font-weight: bold;
      color: #28a745 !important;
      transition: color 0.3s ease;
    }

    .navbar-brand:hover {
      color: #218838 !important;
    }

    .nav-link {
      color: #333;
      transition: color 0.3s ease, transform 0.3s ease;
    }

    .nav-link:hover {
      color: #28a745;
      transform: translateY(-2px);
    }

    .form-control.me-2 {
      min-width: 250px;
      border-radius: 5px;
    }

    .checkout-container {
      max-width: 1400px;
      margin: 20px auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .main-content {
      display: flex;
      gap: 20px;
    }

    .checkout-form {
      flex: 1;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: fadeIn 1s ease-out;
    }

    .map-container {
      width: 550px;
      height: 400px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: fadeIn 1s ease-out;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .delivery-options {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: fadeIn 1s ease-out;
    }

    .form-section h5 {
      font-size: 1.25rem;
      margin-bottom: 15px;
      color: #28a745;
      font-weight: 600;
    }

    .form-control {
      border-radius: 5px;
      transition: border-color 0.3s ease;
    }

    .form-control:focus {
      border-color: #28a745;
      box-shadow: 0 0 5px rgba(40, 167, 69, 0.3);
    }

    .btn-primary {
      width: 100%;
      padding: 10px;
      font-size: 1.1rem;
      background-color: #28a745;
      border: none;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }

    .btn-primary:hover {
      background-color: #218838;
      transform: translateY(-2px);
    }

    .btn-primary:active {
      transform: scale(0.98);
    }

    .cart-item {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      transition: transform 0.3s ease;
    }

    .cart-item:hover {
      transform: translateX(5px);
    }

    .cart-item img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      margin-right: 15px;
      border-radius: 5px;
      transition: opacity 0.3s ease;
    }

    .cart-item img:hover {
      opacity: 0.8;
    }

    .cart-item-details {
      flex: 1;
    }

    .cart-item-details p {
      margin: 0;
      font-size: 0.9rem;
      color: #666;
    }

    .cart-item-details .item-name {
      font-weight: 500;
      color: #333;
    }

    .price-details p {
      margin: 5px 0;
      color: #555;
    }

    .price-details strong {
      color: #28a745;
    }

    .delivery-option {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .delivery-option:hover {
      background-color: #f1f9f1;
      border-color: #28a745;
      transform: translateY(-2px);
    }

    .delivery-option.active {
      background-color: #e6f3e6;
      border-color: #28a745;
      font-weight: 500;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeOut {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }

    @media (max-width: 992px) {
      .main-content {
        flex-direction: column;
      }

      .map-container {
        width: 100%;
        height: 300px;
      }

      .delivery-options {
        margin-top: 20px;
      }
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">GrocDrop.in</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="login.html">Login / Register</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              About GrocDrop
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="about.html">About Us</a></li>
              <li><a class="dropdown-item" href="brands.html">Brands</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="help.html">Help & Support</a></li>
            </ul>
          </li>
        </ul>
        <form class="d-flex flex-wrap align-items-center justify-content-center gap-2" role="search">
          <div class="flex-grow-1" style="min-width: 250px; max-width: 100%;">
            <input class="form-control me-2" type="search" placeholder="Search for Products, Brands and more"
              aria-label="Search">
          </div>
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
      </div>
    </div>
  </nav>

  <div class="checkout-container">
    <div class="main-content">
      <!-- Checkout Form -->
      <div class="checkout-form">
        <h2 class="mb-4">Checkout</h2>
        <form id="checkout-form">
          <!-- Delivery Address -->
          <div class="form-section">
            <h5>Delivery Address</h5>
            <div class="mb-3">
              <label for="fullName" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="fullName" required>
            </div>
            <div class="mb-3">
              <label for="address" class="form-label">Address</label>
              <input type="text" class="form-control" id="address" required>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="city" class="form-label">City</label>
                <input type="text" class="form-control" id="city" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="state" class="form-label">State</label>
                <input type="text" class="form-control" id="state" required>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="zipCode" class="form-label">Zip Code</label>
                <input type="text" class="form-control" id="zipCode" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="phone" required>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="form-section">
            <h5>Order Summary</h5>
            <div id="order-summary" class="mb-3"></div>
            <div class="price-details">
              <p><strong>Subtotal:</strong> <span id="subtotal">₹0.00</span></p>
              <p><strong>Discount (10%):</strong> <span id="discount">₹0.00</span></p>
              <p><strong>Tax (3%):</strong> <span id="tax">₹0.00</span></p>
              <p><strong>Service Fee:</strong> <span id="service-fee">₹0.00</span></p>
              <p><strong>Total:</strong> <span id="total-price">₹0.00</span></p>
            </div>
          </div>

          <!-- Place Order Button -->
          <button type="button" class="btn btn-primary" onclick="placeOrder(event)">Place Order</button>
        </form>
      </div>

      <!-- Map Section -->
      <div class="map-container">
        <div id="map"></div>
      </div>
    </div>

    <!-- Delivery Options Section -->
    <div class="delivery-options">
      <h5>Delivery Options</h5>
      <div class="delivery-option" onclick="selectDeliveryOption(this, 'standard')"
        data-time="2-3 Days" data-cost="Free">
        <input type="radio" name="delivery" id="standard" style="margin-right: 10px;">
        <label for="standard">Standard Delivery (2-3 Days) - Free</label>
      </div>
      <div class="delivery-option" onclick="selectDeliveryOption(this, 'express')"
        data-time="1-2 Days" data-cost="₹99">
        <input type="radio" name="delivery" id="express" style="margin-right: 10px;">
        <label for="express">Express Delivery (1-2 Days) - ₹99</label>
      </div>
      <div class="delivery-option" onclick="selectDeliveryOption(this, 'same-day')"
        data-time="Same Day" data-cost="₹199">
        <input type="radio" name="delivery" id="same-day" style="margin-right: 10px;">
        <label for="same-day">Same Day Delivery - ₹199</label>
      </div>
      <p class="mt-3" id="selected-delivery" style="color: #666;">Selected: None</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPyp3xERabtbIOFcbx1cWTKxtFJ3B-WmI&libraries=places"></script>
  <script>
    let cart = [];
    let map, marker;

    document.addEventListener('DOMContentLoaded', function () {
      try {
        const savedCart = localStorage.getItem('cart');
        if (savedCart) {
          cart = JSON.parse(savedCart);
          updateOrderSummary();
        }
      } catch (error) {
        console.error('Error loading cart:', error);
        cart = [];
      }

      initMap();
    });

    function initMap() {
      const defaultLocation = { lat: 20.5937, lng: 78.9629 };

      map = new google.maps.Map(document.getElementById('map'), {
        center: defaultLocation,
        zoom: 5,
        mapTypeControl: false,
        streetViewControl: false,
      });

      marker = new google.maps.Marker({
        position: defaultLocation,
        map: map,
        draggable: true,
        title: 'Drag to select your location',
      });

      google.maps.event.addListener(marker, 'dragend', function () {
        const position = marker.getPosition();
        updateAddressFromLatLng(position.lat(), position.lng());
      });

      map.addListener('click', function (event) {
        const lat = event.latLng.lat();
        const lng = event.latLng.lng();
        marker.setPosition({ lat, lng });
        updateAddressFromLatLng(lat, lng);
      });
    }

    function updateAddressFromLatLng(lat, lng) {
      const geocoder = new google.maps.Geocoder();
      const latlng = { lat: lat, lng: lng };

      geocoder.geocode({ location: latlng }, function (results, status) {
        if (status === 'OK' && results[0]) {
          const addressComponents = results[0].address_components;
          const formattedAddress = results[0].formatted_address;

          let streetAddress = '';
          let city = '';
          let state = '';
          let zipCode = '';

          for (let component of addressComponents) {
            if (component.types.includes('street_number') || component.types.includes('route')) {
              streetAddress += component.long_name + ' ';
            } else if (component.types.includes('locality')) {
              city = component.long_name;
            } else if (component.types.includes('administrative_area_level_1')) {
              state = component.long_name;
            } else if (component.types.includes('postal_code')) {
              zipCode = component.long_name;
            }
          }

          document.getElementById('address').value = streetAddress.trim() || formattedAddress;
          document.getElementById('city').value = city;
          document.getElementById('state').value = state;
          document.getElementById('zipCode').value = zipCode;
        } else {
          console.error('Geocoder failed due to: ' + status);
          alert('Unable to find address for this location. Please enter manually.');
        }
      });
    }

    function updateOrderSummary() {
      const orderSummary = document.getElementById('order-summary');
      const subtotalElement = document.getElementById('subtotal');
      const discountElement = document.getElementById('discount');
      const taxElement = document.getElementById('tax');
      const serviceFeeElement = document.getElementById('service-fee');
      const totalPriceElement = document.getElementById('total-price');

      orderSummary.innerHTML = '';

      if (cart.length === 0) {
        orderSummary.innerHTML = '<p class="text-muted">Your cart is empty.</p>';
        subtotalElement.textContent = '₹0.00';
        discountElement.textContent = '₹0.00';
        taxElement.textContent = '₹0.00';
        serviceFeeElement.textContent = '₹0.00';
        totalPriceElement.textContent = '₹0.00';
        return;
      }

      let subtotal = 0;

      cart.forEach(item => {
        const itemPrice = getItemPrice(item.name);
        const itemTotal = itemPrice * item.quantity;
        subtotal += itemTotal;

        const itemDiv = document.createElement('div');
        itemDiv.className = 'cart-item';
        itemDiv.innerHTML = `
          <img src="${item.image}" alt="${item.name}">
          <div class="cart-item-details">
            <p class="item-name">${item.name}</p>
            <p>Quantity: ${item.quantity} | ₹${itemPrice.toFixed(2)} each</p>
          </div>
          <span>₹${itemTotal.toFixed(2)}</span>
        `;
        orderSummary.appendChild(itemDiv);
      });

      const discountRate = 0.10;
      const discount = subtotal * discountRate;
      const discountedSubtotal = subtotal - discount;

      const taxRate = 0.03;
      const tax = discountedSubtotal * taxRate;

      const serviceFee = 50.00;
      let deliveryCost = 0;
      const selectedDelivery = document.querySelector('.delivery-option.active');
      if (selectedDelivery) {
        deliveryCost = parseFloat(selectedDelivery.getAttribute('data-cost')) || 0;
      }

      const total = discountedSubtotal + tax + serviceFee + deliveryCost;

      subtotalElement.textContent = `₹${subtotal.toFixed(2)}`;
      discountElement.textContent = `-₹${discount.toFixed(2)}`;
      taxElement.textContent = `₹${tax.toFixed(2)}`;
      serviceFeeElement.textContent = `₹${serviceFee.toFixed(2)}`;
      totalPriceElement.textContent = `₹${total.toFixed(2)}`;
    }

    function getItemPrice(itemName) {
      const prices = {
        'Basmati Rice': 150.00,
        'Sunflower Oil': 120.00,
        'Garam Masala': 80.00,
        'Wheat Flour': 50.00,
        'Toor Dal': 90.00,
        'Mixed Spices': 100.00,
        'Apple': 100.00,
        'Banana': 40.00,
        'Tomato': 30.00,
        'Potato': 25.00,
        'Orange': 60.00,
        'Onion': 35.00,
        'Milk': 40.00,
        'Butter': 50.00,
        'Bread': 30.00,
        'Cheese': 80.00,
        'Yogurt': 25.00,
        'Chocolate Cake': 300.00,
      };
      return prices[itemName] || 50.00;
    }

    function placeOrder(event) {
      event.preventDefault();

      const form = document.getElementById('checkout-form');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const selectedDelivery = document.querySelector('.delivery-option.active');
      const deliveryOption = selectedDelivery ? selectedDelivery.getAttribute('data-time') : 'None';
      const deliveryCost = selectedDelivery ? selectedDelivery.getAttribute('data-cost') : '0';

      const orderDetails = {
        fullName: document.getElementById('fullName').value,
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        state: document.getElementById('state').value,
        zipCode: document.getElementById('zipCode').value,
        phone: document.getElementById('phone').value,
        cart: cart,
        subtotal: document.getElementById('subtotal').textContent,
        discount: document.getElementById('discount').textContent,
        tax: document.getElementById('tax').textContent,
        serviceFee: document.getElementById('service-fee').textContent,
        deliveryOption: deliveryOption,
        deliveryCost: `₹${deliveryCost}`,
        total: document.getElementById('total-price').textContent,
      };
      localStorage.setItem('orderDetails', JSON.stringify(orderDetails));

      document.body.style.animation = 'fadeOut 0.5s ease-out forwards';
      setTimeout(() => {
        window.location.href = 'payment.html';
      }, 500);
    }

    function selectDeliveryOption(element, id) {
      document.querySelectorAll('.delivery-option').forEach(option => option.classList.remove('active'));
      element.classList.add('active');
      const time = element.getAttribute('data-time');
      const cost = element.getAttribute('data-cost');
      document.getElementById('selected-delivery').textContent = `Selected: ${time} - ${cost}`;
      updateOrderSummary();
    }
  </script>
</body>

</html>